<mat-sidenav-container class="sidenav-container">
  
  <mat-sidenav mode="side" opened class="sidebar">
    <div class="logo-area">
      <mat-icon>account_balance_wallet</mat-icon>
      <h1>BANCO <span class="destaque">NEW</span></h1>
    </div>
    
    <nav class="menu-lateral">
      <a class="menu-item ativo"><mat-icon>dashboard</mat-icon> Dashboard</a>
      <a class="menu-item"><mat-icon>people</mat-icon> Clientes</a>
      <a class="menu-item"><mat-icon>credit_card</mat-icon> Cartões</a>
      <a class="menu-item"><mat-icon>bar_chart</mat-icon> Relatórios</a>
      
      <div class="spacer"></div>
      
      <a class="menu-item" (click)="popularBanco()">
        <mat-icon>group_add</mat-icon> Seed DB
      </a>
      <a class="menu-item"><mat-icon>settings</mat-icon> Configurações</a>
    </nav>
  </mat-sidenav>

  <mat-sidenav-content class="content-area">
    
    <header class="top-bar">
      <div class="breadcrumb">
        <small>Páginas / Dashboard</small>
        <h2>Visão Geral</h2>
      </div>
      
      <div class="user-actions">
        <div class="search-bar">
          <mat-icon>search</mat-icon>
          <input type="text" placeholder="Buscar...">
        </div>
        <button mat-icon-button><mat-icon>notifications_none</mat-icon></button>
        <img src="https://ui-avatars.com/api/?name=Admin+User&background=random" class="admin-avatar">
      </div>
    </header>

    <main>
      
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="icon-box"><mat-icon>monetization_on</mat-icon></div>
          <div class="info">
            <p>Saldo sob Custódia</p>
            <h3>{{ totalCustodia | currency:'BRL' }}</h3>
          </div>
        </div>

        <div class="kpi-card">
          <div class="icon-box icon-users"><mat-icon>group</mat-icon></div>
          <div class="info">
            <p>Clientes Ativos</p>
            <h3>{{ totalClientes }}</h3>
          </div>
        </div>

        <div class="kpi-card">
          <div class="icon-box icon-trans"><mat-icon>swap_vert</mat-icon></div>
          <div class="info">
            <p>Transações (Total)</p>
            <h3>{{ totalTransacoes }}</h3>
          </div>
        </div>
      </div>

      <div class="tabela-container">
        <div class="tabela-header">
          <h3>Carteira de Clientes</h3>
          <button mat-flat-button color="primary" (click)="abrirNovoCliente()">
            <mat-icon>add</mat-icon> Novo Cliente
          </button>
        </div>

        <mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>

        <table mat-table [dataSource]="usuarios" *ngIf="!loading">
          
          <ng-container matColumnDef="cliente">
            <th mat-header-cell *matHeaderCellDef> Nome </th>
            <td mat-cell *matCellDef="let user">
              <div class="user-cell">
                <img [src]="getAvatarUrl(user.nome)" class="table-avatar">
                <div class="user-info">
                  <span class="name">{{ user.nome }}</span>
                  <small class="cpf">CPF: {{ user.cpf }}</small>
                </div>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let user">
              <span class="badge-status">Ativo</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="conta">
            <th mat-header-cell *matHeaderCellDef> Conta </th>
            <td mat-cell *matCellDef="let user"> 
              {{ user.contas[0]?.numero ? 'C/C ' + user.contas[0]?.numero : 'Pend.' }} 
            </td>
          </ng-container>

          <ng-container matColumnDef="saldo">
            <th mat-header-cell *matHeaderCellDef> Saldo </th>
            <td mat-cell *matCellDef="let user" class="saldo-text">
              <div style="display: flex; align-items: center; gap: 8px;">
                <span *ngIf="isVisivel(user.id)">
                  {{ user.contas[0]?.saldo | currency:'BRL' }}
                </span>
                <span *ngIf="!isVisivel(user.id)" style="letter-spacing: 2px; color: #ccc;">
                  •••••••
                </span>

                <button mat-icon-button (click)="toggleVisibilidade(user.id)" 
                        style="width: 24px; height: 24px; line-height: 24px;">
                  <mat-icon style="font-size: 18px;">{{ isVisivel(user.id) ? 'visibility_off' : 'visibility' }}</mat-icon>
                </button>
              </div>
            </td>
          </ng-container>

          <ng-container matColumnDef="acoes">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let user">
              
              <div class="actions-container">
                <button mat-flat-button color="primary" class="btn-operar" (click)="abrirOperacao()">
                  Operar
                </button>

                <button mat-icon-button [matMenuTriggerFor]="menu" class="btn-dots">
                  <mat-icon>more_vert</mat-icon>
                </button>
                
                <mat-menu #menu="matMenu" xPosition="before">
                  <button mat-menu-item (click)="abrirExtrato(user.contas[0]?.numero)">
                    <mat-icon>receipt_long</mat-icon> Ver Extrato
                  </button>
                  <button mat-menu-item (click)="abrirTransferencia(user.contas[0]?.numero)">
                    <mat-icon>swap_horiz</mat-icon> Transferir
                  </button>
                  <button mat-menu-item (click)="abrirLimite(user.contas[0]?.numero, user.contas[0]?.limite)">
                    <mat-icon>tune</mat-icon> Ajustar Limite
                  </button>
                </mat-menu>
              </div>

            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <div class="chart-section">
        <div class="chart-card">
          <h3>Fluxo de Caixa Global</h3>
          <canvas baseChart
            [data]="barChartData"
            [options]="barChartOptions"
            [type]="barChartType">
          </canvas>
        </div>
      </div>

    </main>
  </mat-sidenav-content>
</mat-sidenav-container>